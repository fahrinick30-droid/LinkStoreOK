<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link Store - Akses Cepat</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            margin: 0;
            background-color: #f8fafc;
            color: #1e293b;
        }
        .animate-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .notif-badge {
            animation: pulse-red 2s infinite;
        }
        @keyframes pulse-red {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 5px rgba(239, 68, 68, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        .slide-down {
            animation: slideDown 0.5s ease-out forwards;
        }
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .crop-container {
            position: relative;
            width: 100%;
            height: 300px;
            background: #0f172a;
            overflow: hidden;
            border-radius: 1rem;
            cursor: move;
        }
        .crop-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 2px solid #10b981;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.6);
            pointer-events: none;
        }

        .skeleton-shimmer {
            background: linear-gradient(90deg, #f1f5f9 25%, #f8fafc 50%, #f1f5f9 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .cursor-copy { cursor: copy; }
        .zoom-in { cursor: zoom-in; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxq2n3kzAG5R50oxk2_CHcxV5n3oorc1VwJu2IW3az2XMjxZcCGpW9WrdCV2G7pyG6i/exec";
        const STORE_ID = "46ab0f5c-98f9-4e03-a67a-06a7669ae062";
        const NOTIF_SOUND_URL = "https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3";

        const Icon = ({ name, size = 24, className = "" }) => {
            const iconUrl = `https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/${name}.svg`;
            return <img src={iconUrl} alt={name} style={{ width: size, height: size }} className={className} />;
        };

        function App() {
            const [view, setView] = useState('store'); 
            const [adminTab, setAdminTab] = useState('products'); 
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [paymentConfig, setPaymentConfig] = useState({ 
                bankName: '', bankAccount: '', bankHolder: '', 
                qrisNotes: '', qrisUrl: '', 
                danaNumber: '', danaHolder: '',
                isBankActive: true, isQrisActive: true, isDanaActive: false
            });
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [appNotification, setAppNotification] = useState('');
            
            const [deleteTarget, setDeleteTarget] = useState(null);
            const [previewImage, setPreviewImage] = useState(null);
            const [cropData, setCropData] = useState({ show: false, src: null, scale: 1, x: 0, y: 0 });
            const [isSavingCrop, setIsSavingCrop] = useState(false);
            const cropImgRef = useRef(null);

            const [productForm, setProductForm] = useState({ id: '', name: '', url: '', price: '', stock: '', image: '' });
            const [isEditing, setIsEditing] = useState(false);

            const pendingCount = orders.filter(o => String(o.status).toLowerCase() === 'pending').length;

            const fetchData = async () => {
                try {
                    const res = await fetch(`${SCRIPT_URL}?action=getData&storeId=${STORE_ID}&_=${Date.now()}`);
                    const data = await res.json();
                    if (data && data.status !== "error") {
                        setProducts(data.products || []);
                        setOrders(data.orders || []);
                        
                        if (data.config) {
                            const cfg = data.config;
                            setPaymentConfig(prev => ({
                                ...prev,
                                bankName: cfg.bankName || '',
                                bankAccount: cfg.bankAccount || '',
                                bankHolder: cfg.bankHolder || '',
                                qrisNotes: cfg.qrisNotes || '',
                                qrisUrl: cfg.qrisUrl || '',
                                danaNumber: cfg.danaNumber || '',
                                danaHolder: cfg.danaHolder || '',
                                isBankActive: cfg.isBankActive === 'true' || cfg.isBankActive === true,
                                isQrisActive: cfg.isQrisActive === 'true' || cfg.isQrisActive === true,
                                isDanaActive: cfg.isDanaActive === 'true' || cfg.isDanaActive === true,
                            }));
                        }
                        setError(null);
                    } else {
                        setError(data.message || "Gagal mengambil data.");
                    }
                    setLoading(false);
                } catch (e) {
                    setError("Koneksi gagal. Periksa Deploy Google Script.");
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchData();
                const interval = setInterval(fetchData, 30000); 
                return () => clearInterval(interval);
            }, []);

            const handlePost = async (payload) => {
                try {
                    await fetch(SCRIPT_URL, { 
                        method: 'POST', 
                        mode: 'no-cors', 
                        body: JSON.stringify({ ...payload, storeId: STORE_ID }) 
                    });
                    return true;
                } catch (e) { return false; }
            };

            const saveProduct = async () => {
                const { id, name, url, price, stock, image } = productForm;
                if(!name || !url || !price || !stock) return alert("Lengkapi data produk!");

                setLoading(true);
                const actionType = isEditing ? 'updateProduct' : 'addProduct';
                const success = await handlePost({ 
                    action: actionType, 
                    id: isEditing ? id : undefined,
                    name, url, price: Number(price), stock: Number(stock), image
                });

                if (success) {
                    setAppNotification(isEditing ? "PRODUK DIPERBARUI!" : "PRODUK DITAMBAHKAN!");
                    setTimeout(() => setAppNotification(''), 3000);
                    setProductForm({ id: '', name: '', url: '', price: '', stock: '', image: '' });
                    setIsEditing(false);
                    setTimeout(fetchData, 2000);
                } else {
                    alert("Gagal menyimpan data.");
                    setLoading(false);
                }
            };

            const startEditProduct = (p) => {
                setProductForm({ id: p.id || '', name: p.name || '', url: p.url || '', price: p.price || '', stock: p.stock || '', image: p.image || '' });
                setIsEditing(true);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const confirmDelete = async () => {
                if (!deleteTarget) return;
                setLoading(true);
                const productId = deleteTarget.id;
                const deleteName = deleteTarget.name;
                setDeleteTarget(null);
                const success = await handlePost({ action: 'deleteProduct', id: productId });
                if (success) {
                    setAppNotification(`PRODUK "${deleteName}" DIHAPUS.`);
                    setTimeout(() => setAppNotification(''), 3000);
                    setTimeout(fetchData, 2000);
                } else {
                    alert("Gagal menghapus.");
                    setLoading(false);
                }
            };

            const savePaymentConfig = async () => {
                setLoading(true);
                const success = await handlePost({ action: 'updateConfig', ...paymentConfig });
                if (success) {
                    setAppNotification("PENGATURAN DISIMPAN!");
                    setTimeout(() => setAppNotification(''), 3000);
                    setTimeout(fetchData, 2000);
                } else {
                    alert("Gagal menyimpan pengaturan.");
                    setLoading(false);
                }
            };

            const handleCropSave = () => {
                setIsSavingCrop(true);
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = cropImgRef.current;
                canvas.width = 400; canvas.height = 400;
                const zoom = cropData.scale;
                ctx.fillStyle = "white"; ctx.fillRect(0,0, 400, 400);
                const drawW = img.naturalWidth * zoom;
                const drawH = img.naturalHeight * zoom;
                const centerX = 200 + (cropData.x * 2);
                const centerY = 200 + (cropData.y * 2);
                ctx.drawImage(img, centerX - (drawW/2), centerY - (drawH/2), drawW, drawH);
                const base64 = canvas.toDataURL('image/jpeg', 0.6);
                setProductForm({ ...productForm, image: base64 });
                setCropData({ ...cropData, show: false });
                setIsSavingCrop(false);
            };

            const [isDragging, setIsDragging] = useState(false);
            const [startPos, setStartPos] = useState({ x: 0, y: 0 });
            const handleMouseDown = (e) => { setIsDragging(true); setStartPos({ x: e.clientX - cropData.x, y: e.clientY - cropData.y }); };
            const handleMouseMove = (e) => { if (isDragging) setCropData({ ...cropData, x: e.clientX - startPos.x, y: e.clientY - startPos.y }); };
            const handleMouseUp = () => { setIsDragging(false); };

            const formatIDR = (n) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(n);
            const formatPhoneDisplay = (phone) => {
                let p = String(phone || '').trim();
                if (!p) return '';
                return p.startsWith('0') ? p : '0' + p;
            };

            const getWALink = (phone, text) => {
                const phoneStr = formatPhoneDisplay(phone);
                const cleanPhone = phoneStr.replace(/\D/g, '');
                if (!cleanPhone) return '#';
                const apiPhone = cleanPhone.startsWith('0') ? '62' + cleanPhone.slice(1) : cleanPhone;
                return `https://wa.me/${apiPhone}?text=${encodeURIComponent(text)}`;
            };

            const openProductLink = (url) => {
                if (url) {
                    window.open(url, '_blank');
                }
            };

            return (
                <div className="min-h-screen pb-20 text-sm relative text-slate-800">
                    {error && (
                        <div className="bg-red-600 text-white p-4 text-center font-bold sticky top-0 z-[60] shadow-lg animate-pulse uppercase">
                           ⚠️ Masalah Koneksi: {error}
                        </div>
                    )}

                    {appNotification && (
                        <div className="fixed top-0 left-0 w-full z-[100] p-4 slide-down">
                            <div className="bg-emerald-600 text-white p-4 rounded-2xl shadow-2xl flex items-center justify-center gap-3 max-w-md mx-auto border-2 border-emerald-500 font-bold tracking-tight text-center uppercase">
                                <Icon name="bell" size={20} className="text-emerald-100" /> {appNotification}
                            </div>
                        </div>
                    )}

                    <nav className="bg-white border-b sticky top-0 z-20 px-6 h-16 flex items-center justify-between shadow-sm">
                        <div className="flex items-center gap-2 font-bold text-emerald-600 text-xl cursor-pointer select-none" onClick={() => setView('store')}>
                            <Icon name="shopping-bag" className="text-emerald-600" /> 
                            <span>LinkStore</span>
                        </div>
                        <div className="bg-slate-100 p-1 rounded-xl flex gap-1">
                            <button onClick={() => setView('store')} className={`px-4 py-1.5 rounded-lg text-xs font-bold transition-all ${view === 'store' ? 'bg-white text-emerald-600 shadow-sm' : 'text-slate-500'}`}>Toko</button>
                            <button onClick={() => { setView('admin'); fetchData(); }} className={`px-4 py-1.5 rounded-lg text-xs font-bold transition-all relative ${view === 'admin' ? 'bg-white text-emerald-600 shadow-sm' : 'text-slate-500'}`}>
                                Admin {pendingCount > 0 && <span className="absolute -top-1 -right-1 bg-red-500 text-white text-[9px] w-4 h-4 flex items-center justify-center rounded-full border border-white notif-badge font-bold">{pendingCount}</span>}
                            </button>
                        </div>
                    </nav>

                    <main className="max-w-5xl mx-auto px-4 py-8">
                        {loading && products.length === 0 && !error ? (
                            <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 px-2">
                                {[1,2,3,4,5,6].map(i => (
                                    <div key={i} className="bg-white rounded-[2.5rem] border shadow-sm h-[400px] overflow-hidden flex flex-col">
                                        <div className="h-56 w-full skeleton-shimmer"></div>
                                        <div className="p-6 space-y-4 flex-grow flex flex-col">
                                            <div className="h-6 w-3/4 skeleton-shimmer rounded-full"></div>
                                            <div className="h-4 w-1/2 skeleton-shimmer rounded-full"></div>
                                            <div className="h-12 w-full skeleton-shimmer rounded-2xl mt-auto"></div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <>
                                {view === 'admin' ? (
                                    <div className="animate-in space-y-6">
                                        <div className="flex gap-4 border-b pb-1 overflow-x-auto whitespace-nowrap">
                                            <button onClick={() => setAdminTab('products')} className={`pb-4 px-2 text-sm font-bold ${adminTab === 'products' ? 'border-b-2 border-emerald-600 text-emerald-600' : 'text-slate-400'}`}>Produk</button>
                                            <button onClick={() => setAdminTab('orders')} className={`pb-4 px-2 text-sm font-bold relative ${adminTab === 'orders' ? 'border-b-2 border-emerald-600 text-emerald-600' : 'text-slate-400'}`}>Riwayat Pesanan {pendingCount > 0 && <span className="ml-2 bg-red-500 text-white text-[9px] px-1.5 py-0.5 rounded-full notif-badge font-bold">{pendingCount}</span>}</button>
                                            <button onClick={() => setAdminTab('payments')} className={`pb-4 px-2 text-sm font-bold ${adminTab === 'payments' ? 'border-b-2 border-emerald-600 text-emerald-600' : 'text-slate-400'}`}>Pembayaran</button>
                                        </div>
                                        {adminTab === 'products' && (
                                            <div className="grid md:grid-cols-3 gap-8">
                                                <div className="bg-white p-6 rounded-3xl border shadow-sm h-fit space-y-4 sticky top-20">
                                                    <h3 className="font-bold text-xs uppercase text-slate-400 tracking-widest">{isEditing ? 'Edit Produk' : 'Tambah Baru'}</h3>
                                                    <div onClick={() => document.getElementById('prodImg').click()} className="relative aspect-square border-2 border-dashed border-slate-200 rounded-2xl bg-slate-50 flex flex-col items-center justify-center cursor-pointer hover:border-emerald-400 transition-all overflow-hidden">
                                                        <input type="file" id="prodImg" className="hidden" accept="image/*" onChange={(e) => {
                                                            const file = e.target.files[0];
                                                            if (file) {
                                                                const reader = new FileReader();
                                                                reader.onload = () => setCropData({ ...cropData, src: reader.result, show: true, scale: 1, x: 0, y: 0 });
                                                                reader.readAsDataURL(file);
                                                            }
                                                        }} />
                                                        {productForm.image ? <img src={productForm.image} className="w-full h-full object-cover" /> : <div className="text-center text-slate-400"><Icon name="image" size={32} className="mx-auto opacity-30" /><p className="text-[10px] font-bold uppercase tracking-widest mt-1">Foto Sampul</p></div>}
                                                    </div>
                                                    <input className="w-full p-3 bg-slate-50 border rounded-xl text-sm font-medium" placeholder="Nama Produk" value={productForm.name || ''} onChange={e => setProductForm({...productForm, name: e.target.value})} />
                                                    <input className="w-full p-3 bg-slate-50 border rounded-xl text-sm font-medium" placeholder="URL Link" value={productForm.url || ''} onChange={e => setProductForm({...productForm, url: e.target.value})} />
                                                    <div className="grid grid-cols-2 gap-2">
                                                        <input className="w-full p-3 bg-slate-50 border rounded-xl text-sm font-medium" type="number" placeholder="Harga" value={productForm.price || ''} onChange={e => setProductForm({...productForm, price: e.target.value})} />
                                                        <input className="w-full p-3 bg-slate-50 border rounded-xl text-sm font-medium" type="number" placeholder="Stok" value={productForm.stock || ''} onChange={e => setProductForm({...productForm, stock: e.target.value})} />
                                                    </div>
                                                    <button onClick={saveProduct} className={`w-full py-3 text-white font-bold rounded-xl shadow-lg text-xs uppercase transition-all ${isEditing ? 'bg-amber-500 hover:bg-amber-600' : 'bg-emerald-600 hover:bg-emerald-700'}`}>{isEditing ? 'Perbarui Produk' : 'Simpan Produk'}</button>
                                                    {isEditing && <button onClick={() => { setProductForm({ id: '', name: '', url: '', price: '', stock: '', image: '' }); setIsEditing(false); }} className="w-full py-2 text-slate-400 font-bold text-xs uppercase underline text-center">Batal Edit</button>}
                                                </div>
                                                <div className="md:col-span-2 space-y-3">
                                                    {products.length === 0 ? <p className="text-center py-20 text-slate-400 font-medium italic">Belum ada produk.</p> : products.map((p, i) => (
                                                        <div key={i} className="bg-white p-4 rounded-2xl border flex justify-between items-center group shadow-sm transition-all hover:border-emerald-200">
                                                            <div className="flex items-center gap-4">
                                                                <img src={p.image || 'https://placehold.co/400x400?text=Link'} className="w-14 h-14 object-cover rounded-xl border bg-slate-100" />
                                                                <div><p className="font-bold text-slate-700">{p.name}</p><div className="flex gap-2 items-center mt-0.5"><span className={`text-[10px] px-2 py-0.5 rounded font-bold uppercase ${Number(p.stock) <= 0 ? 'bg-red-50 text-red-500' : 'bg-slate-100 text-slate-500'}`}>Stok: {p.stock}</span><span className="text-[10px] text-emerald-600 font-bold">{formatIDR(p.price)}</span></div></div>
                                                            </div>
                                                            <div className="flex gap-1">
                                                                <button onClick={() => startEditProduct(p)} className="text-amber-500 p-2 hover:bg-amber-50 rounded-lg transition-colors"><Icon name="edit-3" size={18}/></button>
                                                                <button onClick={() => setDeleteTarget(p)} className="text-red-400 p-2 hover:bg-red-50 rounded-lg transition-colors"><Icon name="trash-2" size={18}/></button>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                        {adminTab === 'orders' && (
                                            <div className="space-y-4">
                                                {orders.length === 0 ? <p className="text-center py-20 text-slate-400 italic font-bold">Belum ada riwayat transaksi.</p> : [...orders].reverse().map((o, i) => (
                                                    <div key={i} className={`bg-white p-5 rounded-3xl border shadow-sm flex flex-col md:flex-row gap-6 transition-all hover:border-emerald-200`}>
                                                        <img 
                                                            src={o.proof} 
                                                            className="w-24 h-32 object-cover rounded-2xl border bg-slate-100 flex-shrink-0 cursor-zoom-in shadow-sm hover:ring-4 hover:ring-emerald-100 transition-all" 
                                                            onClick={() => setPreviewImage(o.proof)} 
                                                        />
                                                        <div className="flex-grow space-y-3">
                                                            <div className="flex justify-between items-start">
                                                                <p className="font-bold text-lg text-slate-800">{o.productName}</p>
                                                                <span className={`px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider ${String(o.status).toLowerCase() === 'berhasil' ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'}`}>{o.status || 'pending'}</span>
                                                            </div>
                                                            <div className="text-[10px] space-y-1.5 bg-slate-50 p-4 rounded-2xl border">
                                                                <p className="flex justify-between border-b border-slate-200 pb-1 mb-1"><span className="text-slate-400 font-bold">DATA PEMBELI (LAMA)</span> <b className="text-emerald-600 font-bold uppercase tracking-widest">{o.id}</b></p>
                                                                <p className="flex justify-between"><span>NAMA:</span> <b className="text-slate-800 font-bold uppercase">{o.buyerName}</b></p>
                                                                <p className="flex justify-between"><span>WHATSAPP:</span> <b className="text-slate-800 font-bold">{o.buyerPhone}</b></p>
                                                                <p className="flex justify-between"><span>EMAIL:</span> <b className="text-slate-800 font-bold lowercase">{o.buyerEmail || '-'}</b></p>
                                                                <div className="mt-3 pt-3 border-t border-slate-200">
                                                                    <p className="text-slate-400 font-bold mb-1">URL SUMBER:</p>
                                                                    <div className="bg-white p-2 rounded-lg border text-emerald-600 font-mono text-[9px] break-all">{o.productUrl}</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                        {adminTab === 'payments' && (
                                            <div className="max-w-3xl mx-auto space-y-6">
                                                <div className="bg-white p-6 rounded-3xl border shadow-sm space-y-6">
                                                    <h3 className="font-bold text-slate-800 underline underline-offset-4 decoration-emerald-500 uppercase">Pengaturan Pembayaran</h3>
                                                    <div className="p-5 bg-slate-50 rounded-2xl border space-y-4">
                                                        <div className="flex justify-between items-center"><h4 className="font-bold text-xs uppercase text-slate-500">Transfer Bank</h4><input type="checkbox" checked={paymentConfig.isBankActive} onChange={e => setPaymentConfig({...paymentConfig, isBankActive: e.target.checked})} className="w-5 h-5 accent-emerald-500" /></div>
                                                        <div className="grid sm:grid-cols-2 gap-4">
                                                            <input className="p-3 bg-white border rounded-xl text-sm font-medium" placeholder="Nama Bank" value={paymentConfig.bankName || ''} onChange={e => setPaymentConfig({...paymentConfig, bankName: e.target.value})} />
                                                            <input className="p-3 bg-white border rounded-xl text-sm font-medium" placeholder="Nomor Rekening" value={paymentConfig.bankAccount || ''} onChange={e => setPaymentConfig({...paymentConfig, bankAccount: e.target.value})} />
                                                        </div>
                                                        <input className="w-full p-3 bg-white border rounded-xl text-sm font-medium" placeholder="Nama Pemilik" value={paymentConfig.bankHolder || ''} onChange={e => setPaymentConfig({...paymentConfig, bankHolder: e.target.value})} />
                                                    </div>
                                                    <div className="p-5 bg-slate-50 rounded-2xl border space-y-4">
                                                        <div className="flex justify-between items-center"><h4 className="font-bold text-xs uppercase text-slate-500">QRIS Barcode</h4><input type="checkbox" checked={paymentConfig.isQrisActive} onChange={e => setPaymentConfig({...paymentConfig, isQrisActive: e.target.checked})} className="w-5 h-5 accent-emerald-500" /></div>
                                                        <input className="w-full p-3 bg-white border rounded-xl text-sm font-medium" placeholder="URL Gambar QRIS" value={paymentConfig.qrisUrl || ''} onChange={e => setPaymentConfig({...paymentConfig, qrisUrl: e.target.value})} />
                                                        <textarea className="w-full p-3 bg-white border rounded-xl text-sm h-20 font-medium" placeholder="Catatan QRIS" value={paymentConfig.qrisNotes || ''} onChange={e => setPaymentConfig({...paymentConfig, qrisNotes: e.target.value})} />
                                                    </div>
                                                    <div className="p-5 bg-slate-50 rounded-2xl border space-y-4">
                                                        <div className="flex justify-between items-center"><h4 className="font-bold text-xs uppercase text-slate-500">E-Wallet (DANA)</h4><input type="checkbox" checked={paymentConfig.isDanaActive} onChange={e => setPaymentConfig({...paymentConfig, isDanaActive: e.target.checked})} className="w-5 h-5 accent-emerald-500" /></div>
                                                        <div className="grid sm:grid-cols-2 gap-4">
                                                            <input className="p-3 bg-white border rounded-xl text-sm font-medium" placeholder="Nomor DANA" value={paymentConfig.danaNumber || ''} onChange={e => setPaymentConfig({...paymentConfig, danaNumber: e.target.value})} />
                                                            <input className="p-3 bg-white border rounded-xl text-sm font-medium" placeholder="Nama Akun DANA" value={paymentConfig.danaHolder || ''} onChange={e => setPaymentConfig({...paymentConfig, danaHolder: e.target.value})} />
                                                        </div>
                                                    </div>
                                                    <button onClick={savePaymentConfig} className="w-full py-4 bg-slate-900 text-white font-bold rounded-2xl shadow-xl hover:bg-black uppercase text-xs tracking-widest transition-all">Simpan Perubahan</button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 px-2 animate-in">
                                        {products.filter(p => Number(p.stock) > 0).map((p, i) => (
                                            <div 
                                                key={i} 
                                                onClick={() => openProductLink(p.url)}
                                                className="bg-white rounded-[2.5rem] border shadow-sm flex flex-col group hover:shadow-2xl transition-all duration-500 overflow-hidden cursor-pointer"
                                            >
                                                <div className="h-56 w-full bg-slate-100 relative overflow-hidden">
                                                    {p.image ? <img src={p.image} className="w-full h-full object-cover group-hover:scale-110 transition-all duration-700" /> : <div className="w-full h-full flex items-center justify-center text-emerald-600/10"><Icon name="link" size={80} /></div>}
                                                    <div className="absolute top-4 left-4 bg-emerald-500 text-white px-3 py-1 rounded-full font-black text-xs shadow-lg">{formatIDR(p.price)}</div>
                                                    <div className="absolute bottom-4 right-4 bg-white/90 backdrop-blur-sm px-2 py-0.5 rounded-lg text-[9px] font-bold uppercase text-slate-600 tracking-widest">Stok: {p.stock}</div>
                                                </div>
                                                <div className="p-6 flex flex-col flex-grow">
                                                    <h3 className="text-xl font-bold mb-8 flex-grow leading-tight text-slate-800">{p.name}</h3>
                                                    <button className="w-full py-4 bg-slate-900 text-white font-bold rounded-2xl shadow-lg group-hover:bg-black transition-all uppercase text-[11px] tracking-widest">Buka Link</button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </>
                        )}
                    </main>

                    {previewImage && (
                        <div 
                            className="fixed inset-0 z-[150] flex items-center justify-center bg-black/90 backdrop-blur-lg p-4 animate-in cursor-zoom-out"
                            onClick={() => setPreviewImage(null)}
                        >
                            <button className="absolute top-6 right-6 text-white p-3 hover:bg-white/10 rounded-full transition-all">
                                <Icon name="x" size={32} className="invert brightness-200" />
                            </button>
                            <div className="relative max-w-4xl max-h-[90vh] w-full flex items-center justify-center">
                                <img 
                                    src={previewImage} 
                                    className="max-w-full max-h-[90vh] object-contain rounded-xl shadow-2xl border border-white/20 animate-in zoom-in" 
                                    onClick={(e) => e.stopPropagation()} 
                                />
                            </div>
                        </div>
                    )}

                    {deleteTarget && (
                        <div className="fixed inset-0 z-[110] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm animate-in zoom-in">
                            <div className="bg-white w-full max-w-sm rounded-3xl p-8 text-center space-y-6 shadow-2xl border-2">
                                <div className="w-16 h-16 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto"><Icon name="trash-2" size={32} /></div>
                                <div><h3 className="text-xl font-bold text-slate-800">Hapus Produk?</h3><p className="text-slate-500 text-sm mt-2">Menghapus <b className="text-slate-700">{deleteTarget.name}</b> secara permanen.</p></div>
                                <div className="flex gap-3 pt-2">
                                    <button onClick={() => setDeleteTarget(null)} className="flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl text-xs uppercase">Batal</button>
                                    <button onClick={confirmDelete} className="flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl shadow-lg shadow-red-200 text-xs uppercase">Ya, Hapus</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {cropData.show && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/95 backdrop-blur-md">
                            <div className="bg-white w-full max-w-md rounded-[2.5rem] p-8 space-y-6 animate-in zoom-in shadow-2xl border-4 border-slate-800">
                                <div className="text-center"><h3 className="text-2xl font-bold text-slate-800">Atur Foto Produk</h3><p className="text-xs text-slate-400 mt-1 uppercase font-bold tracking-widest">Geser dan perbesar gambar</p></div>
                                <div className="crop-container border-4 border-slate-100" onMouseDown={handleMouseDown} onMouseMove={handleMouseMove} onMouseUp={handleMouseUp} onMouseLeave={handleMouseUp}>
                                    <img ref={cropImgRef} src={cropData.src} className="absolute max-w-none pointer-events-none" style={{ transform: `translate(calc(-50% + ${cropData.x}px), calc(-50% + ${cropData.y}px)) scale(${cropData.scale})`, top: '50%', left: '50%' }} />
                                    <div className="crop-overlay"></div>
                                </div>
                                <div className="space-y-4">
                                    <div className="flex items-center gap-4"><Icon name="minus" size={16} /><input type="range" className="flex-grow accent-emerald-500 h-1.5" min="0.1" max="3" step="0.01" value={cropData.scale} onChange={(e) => setCropData({ ...cropData, scale: Number(e.target.value) })} /><Icon name="plus" size={16} /></div>
                                    <button onClick={handleCropSave} className="w-full py-4 bg-emerald-600 text-white font-bold rounded-2xl shadow-xl uppercase text-xs tracking-widest">Simpan Foto</button>
                                    <button onClick={() => setCropData({ ...cropData, show: false })} className="w-full text-slate-400 font-bold text-[10px] uppercase underline text-center">Batal</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
